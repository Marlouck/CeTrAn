{
    "contents" : "require(rfigshare)\n\nload.buridan.data.export <- function(params,id_prefix=NA,center=FALSE) {\n  \n  if (!inherits(params,\"bur.xml\"))\n    stop(\"params should be of class \\\"bur.xml\\\". \n         created by the function load.buridan.xml()\")\n  \n  # read the data files\n  data <- read.table(paste(params$DATAPATH,params$DATAFILE,sep=\"\"), header=TRUE)\n  \n  # TODO: check if the params are the same\n \n    data$x = data$x-as.numeric(params$ARENA_CENTER_X)\n    data$y = data$y-as.numeric(params$ARENA_CENTER_Y)\n  \n  \n  #create xy coordinates\n  res <- as.numeric(params$ARENA_DIAMETER_MM)/(as.numeric(params$ARENA_RADIUS)*2)\n  txyb <- data.frame(time=data$time,x=data$x*res,y=data$y*res, burst=data$burst)\n  \n  return(txyb)\n\n  \n}\n\n#cetran account\noptions(FigshareKey = \"CT6SBJy8WkkGiQjhFdBBxw\")\noptions(FigsharePrivateKey = \"Ytfb4rBWwFv44eXzrzImWQ\")\noptions(FigshareToken = \"KbrzaL7fgOWEdB4RmQ4LQA084gYzMmCpNdKJGxsSTH6QKbrzaL7fgOWEdX4RmQ4LQA\")\noptions(FigsharePrivateToken = \"Uv7jjeyPByTRKXg5BM6rnw\")\n\nid_data = 98195\nid_metadata_trajectory =153932\nid_metadata_experiments =153933\n\n\n##########read from input in RGG (not yet written, this part of the code will be erased once the rgg is written)\nTemporaryfolder=\"/Users/choupi/Documents/temp\"\ndownmetadata = c()\ndownmetaEXPdata = c()\n\nauthor= \"julien colomb\" \n\nExperimentID = \"Colomb_test\"\ndatagroup = \"/Users/choupi/CeTrAn/example_data/groupscs.txt\"  ##to change for your computer!\ndatagroupfile= \"/Users/choupi/CeTrAn/example_data/\"\n\n  # animal_ID\nspecies =\"Drosophila melanogaster\"\ngender=\"female\"\ngenotype_type = \"wild type\"\ngenotype = \"Wtb\"\ntreatment = \"none\"\n\n  #arena_ID\narena_name = \"buridan 5? brembs\"\narena_form = \"round\"\narena_size1 = 117\narena_size2 = \"none\"\n\n  #Environment-ID: burind\nwalk_env = \"platform\"\nduration = 900\ntracking_resolution = 0.35\nnumber_object = 2\n  #object1_ID\no1_form = \"stripe\"\no1size_X = 30\no1size_Y = 0\no1size_Z = 313\no1position_X = 0\no1position_Y = 293\n\n  #object2_ID\no2_form = \"stripe\"\no2size_X = 30\no2size_Y = 0\no2size_Z = 313\no2position_X = 0\no2position_Y = -293\n\nchangingvariable = \"number_object\" # variable changing in this particular experiment, need to check how to do it for multiple variable change.\n\n#input for modification of the raw data, used for data not coming from buritrack (not tested yet)\n\ntimecol = 1\ntimecoef = 1000\n## !!!!!!!! data inversed , 0:0 not set\nxcol = 3\nxcoef = 0.92\nycol = 2\nycoef = 0.92\n\ncenter= c(100.24, 100.417) #inversed also\n#############################\n\n\n\n\n \n\n  \n#### start of the code that will be used. The metadata may not be complete, still waiting on feedbacks from other users)\nmetadataname= c(\"ExperimentID\",\n                \"species\", \n                \"gender\",\n                \"genotype_type\" ,\n                \"genotype\" ,\n                \"treatment\",\n                \n                \"arena_name\",\n                \"arena_form\",\n                \"arena_size1\",\n                \"arena_size2\",\n                \n                \"walk_env\",\n                \"duration\",\n                \"tracking_resolution\",\n                \"number_object\" ,\n                \n                \"o1_form\", \n                \"o1size_X\",\n                \"o1size_Y\" ,\n                \"o1size_Z\" ,\n                \"o1position_X\",\n                \"o1position_Y\",\n                \n                \"o2_form\",\n                \"o2size_X\",\n                \"o2size_Y\",\n                \"o2size_Z\", \n                \"o2position_X\",\n                \"o2position_Y\")\nmetadata= c(ExperimentID,\n            species, \n            gender,\n            genotype_type ,\n            genotype ,\n            treatment,\n            \n            arena_name,\n            arena_form,\n            arena_size1,\n            arena_size2,\n            \n            walk_env,\n            duration,\n            tracking_resolution,\n            number_object ,\n            \n            o1_form, \n            o1size_X,\n            o1size_Y ,\n            o1size_Z ,\n            o1position_X,\n            o1position_Y,\n            \n            o2_form,\n            o2size_X,\n            o2size_Y,\n            o2size_Z, \n            o2position_X,\n            o2position_Y)\n\n# read from group file (=metadata written by hand, either c(xml file path,group name), or c(data file path, group, timecode in iso)\nClassX = class(metadata[metadataname == changingvariable])\n\n\n # test file will be added soon\n \n\n\n  \n  group <- read.delim(datagroup, header=F, colClasses=c(\"character\",ClassX), col.names=c(\"datapath\",\"group\"))\n  \n## special change if changes in the group file has to be done --- need to be done differently, a priori?\ngroup[,2]=as.factor(group[,2]) \nlevels (group[,2]) = list(\"0\"=\"no_stripe\", \"2\"=\"stripes\")\ngroup[,2]=as.character(group[,2]) \n### end special change\n  if (ncol(group)<3){\n  ## this is the code for buritrack data#\n  \n  ##\n  \n  metadata= c(0, 0, metadata)\n  metadataname= c(\"datapath\",\"time\", metadataname)\n  output_csv= c()\n  for(i in c(1:nrow(group))) #future for loop\n  {\n    \n  metadata[metadataname == changingvariable] = group$group[i]\n  \n  ### load xml file and change metadata\n  params <- list(load.buridan.xml(paste(datagroupfile,group$datapath[i], sep=\"\")))\n  env <- lapply(params, create.env.vars.center)\n  \n    date_of_exp = as.character(ISOdatetime(1970,1,1,0,0,0) + as.numeric(params[[1]]$TIMESTAMP))\n  \n  \n    metadata[metadataname == \"duration\"] =  as.numeric(as.character(params[[1]]$DURATION))/1000 \n    metadata[metadataname == \"tracking_resolution\"] = 1/env[[1]]$res\n    metadata[metadataname == \"time\"] = date_of_exp\n    metadata[metadataname == \"datapath\"] = params[[1]]$DATAFILE\n    \n  ### load data (centered, in mm, no other changes)\n  traj = load.buridan.data.export(params[[1]],99+i, TRUE)\n\n   Namecsv=paste(metadata[metadataname == \"ExperimentID\"],\"-\",99+i,\".csv\", sep=\"\")\n  \n  WD=getwd()\n  setwd(Temporaryfolder)\n  write.csv (traj, file = Namecsv, row.names=FALSE)\n  \n  output_csv= rbind(output_csv, metadata)\n  setwd(WD)\n  }\n  \ncolnames(output_csv)= metadataname\n\nsetwd(Temporaryfolder)\n \nwrite.csv(rbind (downmetadata,output_csv), file = \"metadata_trajectory.csv\", row.names = F)\n\n          \nMET=  data.frame(metadata[metadataname == \"ExperimentID\"],changingvariable, author ) \n  colnames(MET)= c(\"experimentID\", \"changing variable\", \"author of the experiment\")\nwrite.csv(rbind (downmetaEXPdata,MET), file = \"metadata_EXP_trajectory.csv\", row.names = F)\n           \n              \n              \n}\n#### here is the code for figshare. need to be done: make new articles (if necessary), get the metadata file to write on them and upload the new version, seems the ids are wrong...\n\nid_data = 98195\nid_metadata_trajectory =153932\nid_metadata_experiments =153933\n\n for(i in c(1:nrow(group))){\n  Namecsv=paste(metadata[metadataname == \"ExperimentID\"],\"-\",99+i,\".csv\", sep=\"\")\n  fs_upload(id_data,Namecsv)\n  }\nfs_upload(id_metadata_trajectory,\"metadata_trajectory.csv\")\nfs_upload(id_metadata_experiments,\"metadata_EXP_trajectory.csv\")    \n\n\n#### to do\nif (ncol(group)==3){\ngroup <- read.delim(datagroup, header=F, colClasses=c(\"character\",ClassX,\"POSIXct\"))\n\n### figshare creation\nid_data = 153938\nid_metadata_trajectory =153939\nid_metadata_experiments =153940\n  \narticle_categories= \"Neuroscience\"\nid <- fs_new_article(title = \"raw trajectory data\", description = \"format is time (in ms), x position (in mm), y position (in mm), burst (increase while the experiment is stopped and started again with the same animal). Information about the experiment is found in the metadata.\", \n                     type = \"fileset\", tags = c(\"trajectory\", \"open science\", \"semanticweb\", \"test\"), categories=article_categories ,\n                     \n                     visibility= \"draft\", \n                     links=\"buridan.sourceforge.net\")\nid_data <- id\nid <- fs_new_article(title = \"trajectory metadata\", description = \"Data to be found in the data fileset\", \n                     type = \"dataset\", tags = c(\"trajectory\", \"open science\", \"semanticweb\", \"test\"), categories=article_categories ,\n                     \n                     visibility= \"draft\", \n                     links=\"buridan.sourceforge.net\")\n\nid <- fs_new_article(title = \"trajectory experiment metadata\", description = \"Experiment got their metadata: who, when, what was tested\", \n                     type = \"dataset\", tags = c(\"trajectory\", \"open science\", \"semanticweb\", \"test\"), categories=article_categories ,\n                     \n                     visibility= \"draft\", \n                     links=\"buridan.sourceforge.net\")",
    "created" : 1362140173594.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2657507068",
    "id" : "47007011",
    "lastKnownWriteTime" : 1362135395,
    "path" : "D:/dokumente/GitHub/CeTrAn/CeTrAn/other_codes/figshareexport/test_figshare.r",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}